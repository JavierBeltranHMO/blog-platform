<% content_for :title, "Blogs" %>
<div class="container my-4">
  <h1 class="mb-4">ThreadHub</h1>
</div>
<%= search_form_for @q, url:blogs_path, method: :get, html: {class:"row g-3 align-items-center mb-4"} do |f| %>
  <div class="col-auto">
    <%= label_tag :filter, "Search by", class:"col-form-label" %>
  </div>
  <div class="col-auto">
    <%= select_tag :filter, options_for_select([
    ['Title', 'title_cont'],
      ['Date(YYYY-MM-DD)', 'created_at_eq'],
      ['Author', 'user_user_name_cont'],
    ], params[:filter]), class:"form-select", onchange: "document.getElementById('search_field').name= 'q[' + this.value + ']';" %>
  </div>
  <div class="col-auto">
    <%= text_field_tag "q[#{params[:filter] || 'title_cont'}]", params.dig(:q, params[:filter] || 'title_cont'), class:"form-control", id:"search_field", placeholder:"Enter search term"  %>
  </div>
  <div class="col-auto">
    <%= f.submit "Search", class: "btn-primary" %>
  </div>
<%end%>
<%= form_with url: blogs_path, method: :get, local:true do %>
  <div class="mb-3">
    <%= label_tag :sort, "Sort by:" %>
    <%= select_tag :sort, options_for_select([
      ['Date(Newest)', 'date_desc'],
      ['Date(Oldest)', 'date_asc'],
      ['Author(A-Z)', 'author_asc'],
      ['Author(Z-A)', 'author_desc'],
      ['Title(A-Z)', 'title_asc'],
      ['Title(Z-A)', 'title_desc'],
    ], params[:sort]), onchange: 'this.form.submit()' %>
  </div>
<% end %>
<div id="blogs" class="list-group mb-4">
  <% @blogs.each do |blog| %>
    <div class="card mb-3">
      <div class="card-body">
        <h3><%= link_to blog.title, blog_path(blog), class:"text-decoration-none text-dark" %> </h3>
        <p class="text-muted">
          by 
          <% if blog.user.present? %>
            <%= link_to blog.user.user_name, user_path(blog.user), class: "text-decoration-none" %>
          <% else %>
            <em>Deleted</em>
          <% end %>
          Created <%= formatted_blog_date(blog) %>
        </p>
        <%= truncate(strip_tags(blog.body.to_s), length:200) %>
        <%= link_to "Read More", blog_path(blog), class:"btn btn-sm btn-outline-secondary mt-2" %>
      </div>
    </div>
  <% end %>
</div>
<%= link_to "New blog", new_blog_path, class:"btn btn-success" %>
